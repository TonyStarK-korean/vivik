# 📊 Alpha-Z Trading System Documentation
*최종 업데이트: 2024년 11월*

---

## 📌 시스템 개요

Alpha-Z는 바이낸스 선물 거래를 위한 자동화된 트레이딩 시스템입니다. 실시간 WebSocket 데이터를 활용하여 급등 심볼을 포착하고, DCA(Dollar Cost Averaging) 전략을 통해 리스크를 관리하며 수익을 극대화합니다.

### 핵심 특징
- **실시간 WebSocket 기반 모니터링**
- **3가지 진입 전략 (A, B, C 전략 활성화)**
- **고급 DCA 포지션 관리**
- **다단계 청산 시스템**
- **텔레그램 실시간 알림**

---

## 🎯 진입 전략 시스템

### 📈 Strategy A: 3분봉 시세 초입 포착 전략

#### **3분봉 조건 (모두 충족 필요):**

**1️⃣ 조건 1: BB 골든크로스**
- 200봉 이내 BB200 상단선(표준편차 2.0) - BB480 상단선(표준편차 1.5) 골든크로스

**2️⃣ 조건 2: MA 패턴 (모두 충족)**
- 100봉 이내 MA5-MA20 데드크로스 AND 10봉 이내 MA1-MA5 골든크로스
- MA5<MA20 OR MA5-MA20 이격도 2% 이내

**3️⃣ SuperTrend 신호**
- 5분봉 SuperTrend(10-3) 진입 시그널 (최근 5봉 이내)

---

### 📊 Strategy B: 5분봉 초강력 타점 전략

#### **5분봉 조건 (5개 모두 충족 필요):**

**1️⃣ 조건 1: 15분봉 추세**
- 15분봉 MA80 < MA480

**2️⃣ 조건 2: SuperTrend 신호**
- 5분봉 SuperTrend(10-3) 진입 시그널

**3️⃣ 조건 3: MA 관계 (다음 중 하나)**
- **3A**: 200봉 이내 MA80-MA480 골든크로스
- **3B**: MA80<MA480 AND MA80-MA480 이격도 5% 이내

**4️⃣ 조건 4: 패턴 분석 (둘 다 만족)**
- 700봉 이내 MA480이 5연속 이상 우하향 1회 이상
- BB200 상단선이 MA480을 골든크로스

**5️⃣ 조건 5: 단기 모멘텀**
- 20봉 이내 MA5-MA20 골든크로스

---

### 🌊 Strategy C: 15분봉 대박파동 맥점 전략

#### **15분봉 조건 (3개 모두 충족 필요):**

**1️⃣ 조건 1: 복합 MA/BB 패턴**
- (MA80<MA480 OR BB 복합조건) AND 5봉내 BB80-BB200 골든크로스 AND 100봉내 BB200-MA480 교차패턴
- BB 복합조건: (BB80<BB200 AND 이격도 5%이내) OR 100봉내 BB480(표편1.5)-BB200(표편2) 골든크로스

**2️⃣ 조건 2: 단기 진입 신호**
- 5봉이내 MA5<MA20 AND 시가<MA5 AND 종가>MA5

**3️⃣ 조건 3: MA 포지션 확인**
- MA5<MA20 OR 3봉이내 MA5-MA20 골든크로스

---

## 💰 DCA Position Management System

### 📊 포지션 구성

#### **초기 진입 (Initial Entry)**
- **비중**: 자본의 0.8%
- **레버리지**: 10배
- **주문 방식**: 시장가

#### **1차 DCA (First DCA)**
- **트리거**: 진입가 대비 -3%
- **비중**: 자본의 2%
- **레버리지**: 10배
- **주문 방식**: 지정가 (초기 진입 시 자동 생성)

#### **2차 DCA (Second DCA)**
- **트리거**: 진입가 대비 -6%
- **비중**: 자본의 2.5%
- **레버리지**: 10배
- **주문 방식**: 지정가 (초기 진입 시 자동 생성)

### ⚡ DCA 안전장치 (2024년 11월 개선)
- **이전**: 현재가가 DCA 가격의 90% 미만일 때 주문 스킵 (10% 차이)
- **현재**: 현재가가 DCA 가격의 95% 미만일 때 주문 스킵 (5% 차이)
- **효과**: DCA 주문 생성률 향상, 급락 시에도 추가매수 가능

---

## 📉 청산 시스템 (Exit Strategy)

### 1️⃣ **SuperTrend 청산 (최우선 순위)**
- 3분봉 SuperTrend 매도 신호 발생 시 즉시 전량 청산
- 추세 반전의 강력한 신호로 즉시 대응

### 2️⃣ **단계별 청산 (Stage-based Exit)**
손실~본절 구간에서 평단가 최적화를 위한 부분 청산

#### **2차 DCA 단계에서:**
- 1차 DCA 진입가 회복 시 → 2차 DCA 물량만 청산
- 초기 진입가 회복 시 → 1차 DCA 물량만 청산

#### **1차 DCA 단계에서:**
- 초기 진입가 회복 시 → 1차 DCA 물량만 청산

### 3️⃣ **수익 구간 청산**
- **10% 수익**: 50% 물량 청산
- **BB600 상단 돌파 + 5% 수익**: 50% 물량 청산

### 4️⃣ **적응형 손절 (Adaptive Stop Loss)**
단계별 변동성 기반 손절:
- **초기 진입**: -10%
- **1차 DCA 후**: -7%
- **2차 DCA 후**: -5%

### 5️⃣ **트레일링 스톱 (Trailing Stop)**
구간별 하락 허용치:

#### **고수익 구간 (10% 이상) - 2024년 11월 개선**
- **20% 이상 수익**: 최고점에서 15% 하락 허용 (85% 유지)
- **15~20% 수익**: 최고점에서 20% 하락 허용 (80% 유지)
- **10~15% 수익**: 최고점에서 25% 하락 허용 (75% 유지)

#### **중수익 구간 (5~10%)**
- **5~10% 수익**: 최고점에서 50% 하락 시 전량 청산

#### **저수익 구간 (1~5%)**
- **3~5% 수익**: 손실 전환 직전(-0.1%) 청산
- **1~3% 수익**: 본절 보호 모드 활성화

---

## 🔍 심볼 필터링 시스템

### 1단계: 기본 필터링
- 24시간 변동률 8% 이상
- 거래량 상위 심볼

### 2단계: 4시간봉 급등 필터링
- 최근 4봉 중 시가대비 고가 **3% 이상** 급등 (2024년 11월 확정: 3% 기준 적용)
- **AND** 4봉 전 시가 ~ 0봉 종가 전체 상승률 **0% 이상** (전체 구간 상승 확인)

### 3단계: 전략별 조건 확인
- Strategy C/D 조건 체크
- SuperTrend 신호 확인

---

## 📱 텔레그램 알림 시스템

### 진입 신호 알림
```
🚨 전략C: 3분봉 시세 초입 포착 진입 신호 🚨
━━━━━━━━━━━━━━━━━━━━━━
📈 심볼: BTC
💰 현재가: $67,234.56
📊 변동률:
   • 24h: +12.5%
   • 일봉캔들: +8.2%
⏰ 신호발생: 2024-11-04 15:30:45
━━━━━━━━━━━━━━━━━━━━━━
🎯 진입전략: 전략C: 3분봉 시세 초입 포착
✅ 충족조건 (3개):
   • BB200-BB480 골든크로스
   • MA5-MA20 데드크로스
   • SuperTrend 매수신호
━━━━━━━━━━━━━━━━━━━━━━
💡 거래설정:
   • 레버리지: 10배
   • 포지션: 0.8% 상당
   • DCA: -3%/-6% 단계별
```

### DCA 체결 알림
```
✅ DCA 지정가 체결
심볼: BTC/USDT:USDT
단계: first_dca
체결가: $65,217.32
수량: 0.001234
```

### 단계별 청산 알림 (개선됨)
```
📈 단계별 청산 완료
심볼: B2/USDT:USDT
청산 단계: second_dca
진입가: $1.1866      ← 신규 추가
청산가: $1.1776
청산 수량: 0.845218  ← 신규 추가
수익률: -0.81%
```

---

## ⚙️ 시스템 설정값

### 포지션 관리
```python
{
    'initial_weight': 0.008,        # 초기 진입 비중 (0.8%)
    'initial_leverage': 10.0,       # 초기 레버리지

    'first_dca_trigger': -0.03,     # 1차 DCA 트리거 (-3%)
    'first_dca_weight': 0.020,      # 1차 DCA 비중 (2%)
    'first_dca_leverage': 10.0,     # 1차 DCA 레버리지

    'second_dca_trigger': -0.06,    # 2차 DCA 트리거 (-6%)
    'second_dca_weight': 0.025,     # 2차 DCA 비중 (2.5%)
    'second_dca_leverage': 10.0,    # 2차 DCA 레버리지

    'max_total_positions': 10,      # 최대 보유 종목 수
}
```

### 청산 기준
```python
{
    'stop_loss_by_stage': {
        'initial': -0.10,      # 초기: -10%
        'first_dca': -0.07,    # 1차 DCA: -7%
        'second_dca': -0.05    # 2차 DCA: -5%
    },

    'half_profit_threshold': 0.10,  # 10% 절반 청산
    'mid_profit_threshold': 0.05,   # 5% 중간 수익 기준
}
```

---

## 🚀 성능 최적화

### WebSocket 데이터 관리
- **캐싱**: OHLCV 데이터 1200초 캐시
- **병렬 처리**: ThreadPoolExecutor 50 스레드
- **Rate Limit 대응**: 자동 재시도 및 폴백

### 스캔 최적화
- **목표**: 521개 심볼 5-10초 내 처리
- **캐시 활용**: 글로벌 캐시로 API 호출 최소화
- **증분 스캔**: 변경된 데이터만 처리

---

## 📁 시스템 파일 구조

### 핵심 파일
- `one_minute_surge_entry_strategy.py`: 메인 전략 및 진입 로직
- `improved_dca_position_manager.py`: DCA 포지션 관리
- `ws_kline_manager.py`: WebSocket 데이터 관리
- `TRADING_SYSTEM_DOCUMENTATION.md`: 시스템 문서 (본 파일)

### 데이터 파일
- `dca_positions.json`: 활성 포지션 데이터
- `sent_signals.json`: 발송된 알림 기록
- `debug.log`: 디버그 로그

---

## 🔄 최근 주요 업데이트 (2024년 11월)

### ✅ 완료된 개선사항

1. **Strategy C 조건 수정**
   - 조건 2A: MA5-MA20 데드크로스 (60봉)
   - 조건 2B: MA5-MA20 골든크로스 (10봉)

2. **Strategy D 조건 수정**
   - 조건 3A: MA80-MA480 골든크로스 (60→30봉)
   - 조건 5: MA5-MA20 골든크로스 (20→10봉)

3. **필터링 개선**
   - 4시간봉 급등 기준: 4% → 3%

4. **DCA 안전장치 개선**
   - 주문 스킵 기준: 10% → 5% 완화

5. **알림 시스템 개선**
   - 단계별 청산 시 수량 및 진입가 표시 추가

6. **트레일링 스톱 강화**
   - 10% 이상 고수익 구간 트레일링 스톱 추가
   - 수익률별 차등 하락 허용치 적용
   - 20%+: 15% 하락, 15~20%: 20% 하락, 10~15%: 25% 하락 허용

7. **🚨 손절 시스템 버그 수정**
   - check_exit_signal 함수에 손절 체크 누락 문제 해결
   - DCA 단계별 손절 정상 작동 (initial: -10%, first_dca: -7%, second_dca: -5%)
   - 손절 시 텔레그램 알림 추가

---

## 📝 운영 가이드

### 시작 전 체크리스트
1. ✅ API 키 설정 확인
2. ✅ 텔레그램 봇 토큰 설정
3. ✅ 자본금 설정 (기본 $100)
4. ✅ WebSocket 연결 확인

### 일일 모니터링
- 활성 포지션 수 확인
- DCA 주문 체결 상태 확인
- 손익 현황 체크
- 시스템 로그 확인

### 위험 관리
- 최대 10개 포지션 제한
- 포지션당 최대 5.3% 자본 투입 (모든 DCA 포함)
- 단계별 손절 시스템 활성화

---

## ⚠️ 주의사항

1. **실거래 전 시뮬레이션 권장**
2. **네트워크 안정성 필수**
3. **자본금 대비 적정 포지션 유지**
4. **정기적인 로그 모니터링**
5. **급변동 시장에서 주의 운영**

---

*본 문서는 Alpha-Z Trading System의 공식 문서입니다.*
*최종 검토: 2024년 11월 4일*