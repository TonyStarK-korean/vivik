# DCA 시스템 완전 초기화 가이드

## 📋 개요

기존 매매로 인한 모든 DCA 설정, 종목별 진입 제한, 통계 데이터를 초기화하여 DCA 시스템을 처음부터 깨끗하게 시작합니다.

---

## ⚠️ 초기화 전 필수 확인사항

### 1. 거래소 실제 포지션 확인
```
❌ 거래소에 열려있는 포지션이 있으면 안 됩니다!
→ 모든 포지션을 먼저 수동으로 정리하세요
```

### 2. 미체결 주문 확인
```
❌ 미체결 주문이 남아있으면 안 됩니다!
→ 모든 미체결 주문을 취소하세요
```

### 3. 초기화 범위 이해
다음 데이터가 **모두 삭제**됩니다:
- ✗ 모든 DCA 포지션 기록
- ✗ 종목별 진입 제한 카운트
- ✗ 일일 거래 통계
- ✓ 설정 파일(dca_config.json)은 유지됨

---

## 🔧 초기화 방법

### 방법 1: 자동 초기화 (빠른 실행)

거래소 포지션을 확인했다면 즉시 실행:

```bash
python reset_dca_auto.py
```

**실행 내용:**
1. 자동 백업 생성 (backup_auto_YYYYMMDD_HHMMSS/)
2. 모든 DCA 파일 초기화
3. 검증 완료

**소요 시간:** 약 1초

---

### 방법 2: 대화형 초기화 (안전한 실행)

단계별 확인과 함께 실행:

```bash
python reset_dca_system_clean.py
```

**실행 내용:**
1. 백업 생성
2. 안전성 확인 프롬프트 (yes/no)
3. 파일 초기화
4. 검증 및 다음 단계 안내

**소요 시간:** 약 10초 (사용자 확인 포함)

---

## 📊 초기화되는 파일 목록

| 파일 | 초기화 전 | 초기화 후 | 비고 |
|------|----------|----------|------|
| **dca_positions.json** | 포지션 데이터 | `{}` | 빈 객체 |
| **dca_limits.json** | 종목별 카운트 43개 | `{}` | 빈 객체 |
| **dca_positions_backup.json** | 백업 데이터 | `{}` | 빈 객체 |
| **daily_stats.json** | 과거 통계 | 오늘 날짜 초기 상태 | 리셋 |
| **dca_config.json** | 설정 | **유지됨** | ✓ 보존 |

---

## ✅ 초기화 검증

초기화 완료 후 자동 검증:

```
✓ dca_positions.json: {}
✓ dca_limits.json: {}
✓ dca_positions_backup.json: {}
✓ daily_stats.json: 오늘 날짜, total_trades=0
✓ dca_config.json: 옵션A 설정 유지
```

---

## 🔄 초기화 후 작업

### 1. 전략 봇 재시작

```bash
python one_minute_surge_entry_strategy.py
```

### 2. 현재 설정 확인 (옵션A)

```
최대 종목: 10개
초기 진입: 1.5% (15% 노출)
1차 DCA: 2.0% @ -3% (20% 노출)
2차 DCA: 2.0% @ -6% (20% 노출)
단계별 손절: 초기 -10%, 1차 -7%, 2차 -5%
```

### 3. 모니터링

- DCA 시스템이 깨끗한 상태에서 시작됨
- 종목별 진입 제한이 리셋됨
- 모든 종목에 새로 진입 가능

---

## 💾 백업 위치

초기화 시 자동으로 백업이 생성됩니다:

```
backup_auto_YYYYMMDD_HHMMSS/
├── dca_positions.json
├── dca_limits.json
├── dca_positions_backup.json
└── daily_stats.json
```

**복구 방법:**
백업 폴더의 파일들을 프로젝트 루트로 복사

---

## 🚨 문제 해결

### Q1: "거래소에 포지션이 남아있는데 초기화했어요"

**A:** 심각한 문제입니다!

1. 즉시 수동으로 포지션 정리
2. 백업 폴더에서 복구하지 마세요 (꼬임 발생)
3. 모든 포지션 정리 후 다시 시작

### Q2: "초기화 후 바로 진입이 안 돼요"

**A:** 정상입니다.

- 스캔 조건을 만족하는 종목을 기다리세요
- 10초마다 스캔 실행됨

### Q3: "종목별 제한이 리셋되었는지 확인하고 싶어요"

**A:** 파일 확인:

```bash
# Windows
type dca_limits.json

# 결과: {}
```

### Q4: "백업을 복구하고 싶어요"

**A:** 복구 방법:

```bash
# 백업 폴더 찾기
dir backup_auto_*

# 복구 (예시)
copy backup_auto_20251028_134558\*.json .
```

---

## 📈 초기화 효과

### Before (초기화 전)
```
✗ dca_limits.json: 43개 종목 제한
✗ 일부 종목 진입 불가
✗ 과거 데이터 꼬임 가능
```

### After (초기화 후)
```
✓ dca_limits.json: 깨끗한 상태
✓ 모든 종목 진입 가능
✓ 완전히 새로 시작
```

---

## 🎯 권장 사용 시기

1. **전략 변경 후**: 옵션A로 변경했을 때
2. **시스템 꼬임**: DCA 카운트가 이상할 때
3. **새로 시작**: 과거 기록을 지우고 처음부터
4. **테스트 완료**: 실전 전 깨끗한 상태로

---

## 📝 체크리스트

초기화 전:
- [ ] 거래소 포지션 모두 정리
- [ ] 미체결 주문 모두 취소
- [ ] 중요 데이터 별도 백업 (선택)

초기화:
- [ ] `python reset_dca_auto.py` 실행
- [ ] SUCCESS 메시지 확인

초기화 후:
- [ ] JSON 파일들이 깨끗한지 확인
- [ ] 전략 봇 재시작
- [ ] 정상 동작 모니터링

---

## 🔗 관련 파일

- `reset_dca_auto.py` - 자동 초기화 스크립트
- `reset_dca_system_clean.py` - 대화형 초기화 스크립트
- `validate_option_a_config.py` - 옵션A 설정 검증
- `test_integration_option_a.py` - 통합 테스트

---

## ⚡ 빠른 참조

```bash
# 초기화
python reset_dca_auto.py

# 검증
python validate_option_a_config.py

# 전략 시작
python one_minute_surge_entry_strategy.py
```

---

**마지막 업데이트**: 2025-10-28
**버전**: 1.0 (옵션A 완전 초기화)
